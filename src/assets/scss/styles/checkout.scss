/**
 * Checkout Page Styles
 *
 * Custom styling for WooCommerce checkout
 */

// ============================================
// Checkout Specific Overrides
// ============================================

.woocommerce-checkout {
	// Required field asterisk
	.required {
		@apply text-red-500 ml-1;
	}

	// Select dropdown arrow
	select {
		@apply appearance-none bg-white;
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23333333'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
		background-repeat: no-repeat;
		background-position: right 0.75rem center;
		background-size: 1.25rem;
		@apply pr-10;
	}

	// Textarea
	textarea {
		@apply min-h-[100px] resize-y;
	}

	// Placeholder text
	input::placeholder,
	textarea::placeholder {
		@apply text-gray-400;
	}

	// Validation states
	.woocommerce-invalid {
		input,
		select,
		textarea {
			@apply border-red-500 focus:ring-red-500 focus:border-red-500 #{!important};
		}

		label {
			@apply text-red-600;
		}
	}

	.woocommerce-validated {
		input:not([type="checkbox"]):not([type="radio"]),
		select,
		textarea {
			@apply border-green-500 focus:ring-green-500 focus:border-green-500 #{!important};
		}
	}

	// Error messages
	.woocommerce-error,
	.woocommerce-NoticeGroup-checkout {
		@apply bg-red-50 border border-red-200 text-red-800 rounded-lg p-4 mb-6;

		li {
			@apply text-sm list-none;
		}

		a {
			@apply text-red-600 hover:text-red-800 underline font-medium;
		}
	}

	// ============================================
	// Select2 Dropdown Styling (Country/Region)
	// ============================================

	// Style Select2 container to match input fields
	.select2-container {
		@apply w-full;

		.select2-selection--single {
			@apply w-full px-4 py-3 border border-gray-300 rounded-lg;
			@apply text-sm text-ats-dark bg-white;
			@apply transition-colors duration-200;
			height: auto !important;
			min-height: 48px !important;
			display: flex !important;
			align-items: center !important;

			.select2-selection__rendered {
				@apply text-sm text-ats-dark;
				padding: 0 !important;
				line-height: normal !important;
			}

			.select2-selection__arrow {
				height: 100% !important;
				top: 0 !important;
				right: 12px !important;

				b {
					border-color: theme('colors.ats.dark') transparent transparent transparent !important;
					border-width: 6px 4px 0 4px !important;
					margin-left: -4px !important;
					margin-top: -3px !important;
				}
			}
		}

		// Hover state
		.select2-selection--single:hover {
			@apply border-gray-400;
		}

		// Focus state
		&.select2-container--focus,
		&.select2-container--open {
			.select2-selection--single {
				@apply ring-2 ring-ats-yellow border-ats-yellow;
				outline: none !important;
			}
		}
	}

	// Style Select2 dropdown results
	.select2-dropdown {
		@apply border border-gray-300 rounded-lg shadow-lg;
		margin-top: 4px !important;

		.select2-search--dropdown {
			padding: 8px !important;

			.select2-search__field {
				@apply w-full px-3 py-2 border border-gray-300 rounded-lg text-sm;
				@apply focus:ring-2 focus:ring-ats-yellow focus:border-ats-yellow;
			}
		}

		.select2-results__options {
			.select2-results__option {
				@apply px-4 py-2 text-sm text-ats-dark;

				&:hover,
				&.select2-results__option--highlighted {
					@apply bg-ats-yellow bg-opacity-10 text-ats-dark;
				}

				&.select2-results__option--selected {
					@apply bg-gray-100 text-ats-dark;
				}
			}
		}
	}
}

// ============================================
// Crafty Clicks Postcode Lookup
// ============================================

.woocommerce-checkout {
	// Target only the crafty clicks postcode fields specifically
	// Input field (form-row-first)
	.crafty_billing.form-row-first,
	.crafty_shipping.form-row-first {
		@apply mb-0;
		display: inline-block !important;
		vertical-align: top !important;
		width: calc(65% - 0.5rem) !important;
		float: none #{!important};
		margin-right: 1rem !important;
		margin-left: 0 !important;

		label {
			@apply text-sm font-medium text-ats-dark mb-2 block;
		}
	}

	// Button field (form-row-last)
	.crafty_billing.form-row-last,
	.crafty_shipping.form-row-last {
		@apply mb-0;
		display: inline-block !important;
		vertical-align: top !important;
		width: calc(35% - 1rem) !important;
		float: none #{!important};
		margin-left: 0 !important;
		margin-right: 0 !important;

		// Hide the empty label but maintain spacing
		label {
			@apply mb-2 block text-sm;
			visibility: hidden !important;
			height: 1.75rem !important;
		}
	}

	// Postcode search input field - make it wider and better looking
	.crafty_billing input.input-text,
	.crafty_shipping input.input-text {
		@apply w-full px-4 py-3 border border-gray-300 rounded-lg;
		@apply text-sm text-ats-dark;
		@apply focus:ring-2 focus:ring-ats-yellow focus:border-ats-yellow;
		@apply transition-colors duration-200;
		min-height: 48px !important;
		float: none #{!important};
	}

	// Find Address button - ATS brand dark styling, aligned with input
	#billing_cp_button,
	#shipping_cp_button {
		@apply px-6 py-3 bg-ats-dark text-white;
		@apply text-sm font-semibold rounded-lg;
		@apply transition-all duration-200;
		@apply border-0 cursor-pointer;
		@apply hover:bg-primary-700;
		min-height: 48px !important;
		white-space: nowrap !important;
		float: none #{!important};

		// Override any inline styles from plugin
		background-color: theme('colors.ats.dark') #{!important};
		color: white #{!important};
		border: 0 #{!important};
		border-radius: 0.5rem #{!important};

		&:hover {
			background-color: theme('colors.primary.700') #{!important};
		}
	}

	// Results dropdown
	.crafty_billing select,
	.crafty_shipping select {
		@apply w-full px-4 py-3 border border-gray-300 rounded-lg;
		@apply text-sm text-ats-dark appearance-none bg-white;
		@apply focus:ring-2 focus:ring-ats-yellow focus:border-ats-yellow;
		@apply transition-colors duration-200;
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23333333'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
		background-repeat: no-repeat;
		background-position: right 0.75rem center;
		background-size: 1.25rem;
		@apply pr-10;
	}

	// Manual entry link
	#billingcc_c2a_manual,
	#shippingcc_c2a_manual {
		@apply text-xs text-ats-text underline cursor-pointer;
		@apply hover:text-ats-dark transition-colors;
		margin-top: 0.5rem !important;
		display: inline-block !important;
	}

	// Fix postcode lookup inline layout
	// Create a wrapper div that contains both fields on the same line
	.woocommerce-billing-fields__field-wrapper,
	.woocommerce-shipping-fields__field-wrapper {
		// Make crafty fields break out of grid and use inline-block
		.crafty_billing,
		.crafty_shipping {
			grid-column: 1 / -1 !important; // Span all columns
		}
	}
}

// ============================================
// Order Review Table
// ============================================

/*
 * IMPORTANT: WooCommerce AJAX requires proper table structure
 */
.woocommerce-checkout-review-order-table {
	width: 100% !important;
	border-collapse: collapse !important;

	tr {
		border-bottom: 1px solid theme('colors.gray.100');

		&:last-child {
			border-bottom: none;
		}

		&.order-total {
			border-top: 2px solid theme('colors.gray.200');
		}
	}

	th,
	td {
		vertical-align: top;
	}
}

// ============================================
// Shipping Methods Styling
// ============================================

.woocommerce-checkout-review-order {
	// Shipping methods container
	#shipping_method {
		@apply space-y-3;

		li {
			@apply list-none m-0 p-0;

			// All labels styled as cards
			label {
				@apply flex items-center gap-3 p-4 border border-gray-200 rounded-lg cursor-pointer;
				@apply transition-all duration-200;
				@apply hover:border-gray-300;

				input[type="radio"] {
					@apply w-4 h-4 text-ats-yellow bg-white border-gray-300;
					@apply focus:ring-ats-yellow focus:ring-2;
					@apply cursor-pointer flex-shrink-0;
				}

				.woocommerce-Price-amount {
					@apply font-semibold text-ats-dark;
				}
			}

			// Selected shipping method gets yellow background
			label:has(input:checked) {
				@apply bg-ats-yellow bg-opacity-10 border-ats-yellow #{!important};
			}
		}
	}

	// Shipping methods in checkout review
	.woocommerce-shipping-totals {
		#shipping_method {
			li {
				@apply list-none m-0 p-0;

				// Radio button wrapper (div)
				.rfs-ref-shipping-radio-wrapper {
					@apply flex items-center gap-3 p-3 border border-gray-200 rounded-lg cursor-pointer;
					@apply transition-all duration-200;
					@apply hover:border-gray-300;

					input[type="radio"] {
						@apply w-4 h-4 text-ats-yellow bg-white border-gray-300;
						@apply focus:ring-ats-yellow focus:ring-2;
						@apply cursor-pointer flex-shrink-0;
					}

					label {
						@apply mb-0 cursor-pointer flex-grow;
						// Remove any padding, margin, border from label and its children
						padding: 0 !important;
						border: none !important;

						span {
							// Remove border and padding from inner span
							@apply border-0 p-0 m-0;
							display: inline !important;
						}

						.woocommerce-Price-amount {
							@apply font-semibold text-ats-dark;
						}
					}

					// Selected state
					&:has(input:checked) {
						@apply bg-ats-yellow bg-opacity-10 border-ats-yellow #{!important};
					}
				}

				// Single method (hidden input + label)
				.rfs-ref-shipping-single {
					@apply p-3 border border-gray-200 rounded-lg bg-gray-50 text-sm;
				}
			}
		}
	}
}
